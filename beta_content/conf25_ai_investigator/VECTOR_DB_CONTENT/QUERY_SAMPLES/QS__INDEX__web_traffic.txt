User query: Detect any sequences of HTTP status codes that indicate potential attacks.
SPL answer: index=web_traffic earliest=-1d latest=now | streamstats current=f last(status) as prev_status BY src_ip | eval status_sequence=prev_status."->".status | search status_sequence="200->5*" | table _time src_ip status_sequence

User query: Find the ratio of mobile to desktop user agents accessing the site.
SPL answer: index=web_traffic earliest=-1d latest=now | eval device_type=if(like(http_user_agent, "%Mobile%"), "Mobile", "Desktop") | stats count BY device_type | eventstats sum(count) as total | eval percentage=(count/total)*100 | table device_type count percentage

User query: Detect users whose session durations are significantly longer than average.
SPL answer: index=web_traffic earliest=-1d latest=now | transaction username maxspan=4h | eventstats avg(duration) as avg_duration | where duration > (avg_duration * 2) | table username duration avg_duration

User query: Show me all events generated by user admin
SPL answer: index=web_traffic username="admin"

User query: List last 1000 raw events today
SPL answer: index=web_traffic earliest=-1d latest=now | sort - _time | head 1000 | table _time src_ip Country Region City username http_method logged_in http_user_agent status uri_path

User query: List last 1000 events today from China
SPL answer: index=web_traffic earliest=-1d latest=now Country="China" | sort - _time | head 1000 | table _time src_ip Country Region City http_method username logged_in http_user_agent status uri_path

User query: List last 1000 events today not coming from China
SPL answer: index=web_traffic earliest=-1d latest=now NOT Country="China" | sort - _time | head 1000 | table _time src_ip Country Region City http_method username logged_in http_user_agent status uri_path

User query: List last 1000 events today not coming from China or Japan
SPL answer: index=web_traffic earliest=-1d latest=now NOT Country IN ("China", "Japan")  | sort - _time | head 1000 | table _time src_ip Country Region City http_method username logged_in http_user_agent status uri_path

User query: List IPs that have accessed the site using suspicious HTTP methods.
SPL answer: index=web_traffic earliest=-1d latest=now http_method IN ("TRACE", "TRACK", "DELETE", "PROPFIND") | stats count BY src_ip http_method | table src_ip http_method count

User query: Find users who have downloaded more than 500MB in a single session.
SPL answer: index=web_traffic earliest=-1d latest=now | transaction username maxspan=4h | eval total_bytes=bytes_out+bytes_in | where total_bytes > 524288000 | table username total_bytes

User query: Find users who have logged in during unusual hours (e.g., midnight to 4 AM).
SPL answer: index=web_traffic earliest=-7d latest=now logged_in=1 | eval hour=strftime(_time, "%H") | where hour>=0 AND hour<=4 | stats count BY username hour | table username count hour

User query: Show the top 5 cities with the longest average session durations.
SPL answer: index=web_traffic earliest=-7d latest=now | transaction src_ip maxspan=4h | stats avg(duration) as avg_session BY Country City | sort - avg_session | head 5 | table Country City avg_session
